# ---
# apiVersion: metallb.io/v1beta1
# kind: IPAddressPool
# metadata:
#   name: metallb-l2-pool
#   namespace: kube-system
# spec:
#   addresses:
#   - '${NETWORK_BGP_SVC_RANGE}'
#   avoidBuggyIPs: true
# ---
# apiVersion: metallb.io/v1beta1
# kind: L2Advertisement
# metadata:
#   name: metallb-l2
#   namespace: kube-system
# spec:
#   ipAddressPools:
#   - metallb-l2-pool
---
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: metallb-bgp-pool
  namespace: kube-system
spec:
  addresses:
  - '${NETWORK_BGP_SVC_RANGE}'
  avoidBuggyIPs: true
---
apiVersion: metallb.io/v1beta1
kind: BGPAdvertisement
metadata:
  name: metallb-bgp-advertisement
  namespace: kube-system
spec:
  ipAddressPools:
  - metallb-bgp-pool
---
apiVersion: metallb.io/v1beta2
kind: BGPPeer
metadata:
  name: metallb-bgp
  namespace: kube-system
spec:
  myASN: 64500
  peerASN: 64512
  peerAddress: ${GATEWAY_MANAGEMENT}
  bfdProfile: bfdprofile
---
# https://metallb.universe.tf/configuration/#enabling-bfd-support-for-bgp-sessions
apiVersion: metallb.io/v1beta1
kind: BFDProfile
metadata:
  name: bfdprofile
  namespace: kube-system
spec:
  receiveInterval: 380
  transmitInterval: 270

