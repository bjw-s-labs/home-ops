---
apiVersion: metal.sidero.dev/v1alpha1
kind: Environment
metadata:
  name: default
spec:
  initrd:
    url: https://github.com/siderolabs/talos/releases/download/v1.2.0-beta.0/initramfs-amd64.xz
  kernel:
    args:
      - console=tty0
      - console=ttyS0
      - consoleblank=0
      - earlyprintk=ttyS0
      - ima_appraise=fix
      - ima_hash=sha512
      - ima_template=ima-ng
      - init_on_alloc=1
      - initrd=initramfs.xz
      # Overrides DNS servers to get the intial boot to use local DNS servers. Without this, it seems to default to 1.1.1.1/8.8.8.8
      # Missing values means do not override
      # ip=<client-ip>:<server-ip>:<gw-ip>:<netmask>:<hostname>:<device>:<autoconf>:<dns0-ip>:<dns1-ip>:<ntp0-ip>
      # - ip=<:::::::10.200.1.1:10.200.1.1:10.200.1.1
      - nvme_core.io_timeout=4294967295
      - printk.devkmsg=on
      - pti=on
      - random.trust_cpu=on
      - slab_nomerge=
      - talos.config=http://sidero.${HARDWARE_DOMAIN}:8081/configdata?uuid=
      - talos.platform=metal
      # This cannot be set at all times. It will constantly wipe the drives!
      # - talos.experimental.wipe=system
    url: https://github.com/siderolabs/talos/releases/download/v1.2.0-beta.0/vmlinuz-amd64
