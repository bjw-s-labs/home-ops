---
# yaml-language-server: $schema=https://k8s-schemas.bjw-s.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: mumc
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: mumc-secret
    creationPolicy: Owner
    template:
      data:
        mumc_config.yaml: |
          ---
          version: 5.11.36
          basic_settings:
            filter_statements:
              episode:
                played:
                  condition_days: 14
                  count_equality: '>='
                  count: 1
          advanced_settings:
            whitetags:
              episode:
                - archive
            REMOVE_FILES: true
            behavioral_statements:
              episode:
                whitetagged:
                  action: keep
                  user_conditional: all
                  played_conditional: ignore
                  action_control: 3
                  dynamic_behavior: false
            console_controls:
          admin_settings:
            server:
              brand: emby
              url: http://emby.media.svc.cluster.local:8096
              auth_key: {{ .emby_api_key_mumc }}
            behavior:
              list: blacklist
              matching: byId
              users:
                monitor_disabled: false
            media_managers:
              radarr: []
              sonarr: []
            users:
              - user_id: 1b414991b63f4e24829c0ab7dad8a7d9
                user_name: Bernd
                blacklist:
                  - lib_id: ca1fc9fedb3e42ac981cbfc3bbead7c8
                    lib_name: TV shows
                    collection_type: tvshows
                    path: /data/nas-media/Library/Main/Series
                    network_path: null
                    subfolder_id: '4'
                    lib_enabled: true
                whitelist: []
              - user_id: 1fa85863d9ba4961b466d643503dcb15
                user_name: Man-Yie
                blacklist:
                  - lib_id: ca1fc9fedb3e42ac981cbfc3bbead7c8
                    lib_name: TV shows
                    collection_type: tvshows
                    path: /data/nas-media/Library/Main/Series
                    network_path: null
                    subfolder_id: '4'
                    lib_enabled: true
                whitelist: []
          DEBUG: 0
  dataFrom:
    - extract:
        key: Emby
      rewrite:
        - regexp:
            source: "(.*)"
            target: "emby_$1"
