---
- name: Check if nginx.service exists
  ansible.builtin.stat:
    path: /lib/systemd/system/nginx.service
  register: var_nginxservice

- name: Stop nginx.service if service exists
  become: true
  ansible.builtin.systemd:
    name: nginx.service
    state: stopped
    enabled: false
  changed_when: false
  when: var_nginxservice.stat.exists

- name: Remove mainsail site configuration
  become: true
  ansible.builtin.file:
    path: "{{ item }}"
    state: absent
  with_items:
    - /etc/nginx/sites-available/mainsail
    - /etc/nginx/sites-enabled/mainsail

- name: Remove mainsail installation
  become: true
  ansible.builtin.file:
    path: "{{mainsail_install_path}}"
    state: absent

- name: Restart nginx
  become: true
  ansible.builtin.systemd:
    name: nginx.service
    state: restarted
    enabled: true
    daemon_reload: true
  changed_when: false
