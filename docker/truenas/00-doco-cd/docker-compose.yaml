---
secrets:
  sops_age_key:
    file: /home/truenas_admin/.sops/sops_age_key.txt
  webhook_secret:
    file: /home/truenas_admin/.config/doco-cd/webhook_secret

services:
  app:
    container_name: doco-cd
    environment:
      HTTP_PORT: 8080
      LOG_LEVEL: info
      TZ: Europe/Amsterdam
      SOPS_AGE_KEY_FILE: /run/secrets/sops_age_key
      WEBHOOK_SECRET_FILE: /run/secrets/webhook_secret
    healthcheck:
      interval: 30s
      retries: 3
      start_period: 15s
      test:
        - CMD
        - wget
        - '--no-verbose'
        - '--tries=1'
        - '--spider'
        - http://localhost:8080/v1/health
      timeout: 5s
    image: ghcr.io/kimdre/doco-cd:0.50.0
    ports:
      - 8080:8080
    restart: unless-stopped
    secrets:
      - sops_age_key
      - webhook_secret
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - data:/data
volumes:
  data: {}
